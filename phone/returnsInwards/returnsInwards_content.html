<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../css/ui-box.css">
        <link rel="stylesheet" href="../css/ui-base.css">
        <link rel="stylesheet" href="../css/ui-color.css">
        <link rel="stylesheet" href="../css/appcan.icon.css">
        <link rel="stylesheet" href="../css/appcan.control.css">   
        <link rel="stylesheet" href="css/yqq_cgrk.css">
        <link rel="stylesheet" href="css/wkf.css"/>
        <script src="../js/init.js"></script>
    </head>
    <body class="um-vp " ontouchstart>
        <div class="ub  ub-ver">
            <!-- 工位开始 -->
          <div class="ub ub-f1 ub-ver yqq-xxk uc-a uinn umar-a ">  
              <div class="ub yqq-w10" >
                 <div  id="emptystation" class="ub w-click yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">工位</div>
                 <div  id="station" class="ub ub-f1 w-click umar-l yqq-bbd uinn ub-ac ub-pc wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div id="emptycategory" class="ub yqq-w3 w-click yqq-bbd uinn ub-pc ub-ac wkf-font-w">单别</div>
                 <div id="category"  class="ub ub-f1 w-click umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div id="emptysupplier" class="ub yqq-w3 w-click yqq-bbd uinn ub-pc ub-ac wkf-font-w">供应商</div>
                 <div id="supplier" class="ub ub-f1 w-click umar-l yqq-bbd uinn ub-ac ub-pc wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10 " >
                 <div  class="ub yqq-w3  uinn yqq-bbd ub-pc ub-ac wkf-font-w">退货日期</div>
                 <div id="time" class="ub ub-f1 umar-l  yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z"></div>
              </div>
          </div>
          <!-- 工位结束 -->
          <!--采购单号开始-->
          <div id="updataPart" class="ub ub-f1 ub-ver yqq-xxk uc-a uinn umar-a " style="margin-bottom: 1em">
              <div class="ub yqq-w10" >
                 <div id="emptyBarcode" class="ub w-click yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">条码</div>
                 <div id="barcode" class="w-click ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div id="emptyNum" class="w-click ub yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">&diams;品号</div>
                 <div id="articleNum" class="w-click ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div  class="ub yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">品名</div>
                 <div id="articleName" class="ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div  class="ub yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">规格</div>
                 <div id="standard" class="ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div  class="ub yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">数量<div id="unit" class="wkf-font-r"></div></div>
                 <div  class="ub ub-f1 umar-l yqq-bbd ub-ac ub-pc wkf-font-z">
                     <input onkeyup="this.value=this.value.replace(/[^\d{1,}\.\d{1,}|\d{1,}]/g,'')" type="number" id="amount" name=""  class="wkf-input-nob wkf-font-w" style="width:98%;text-align:center;border:none; height: 2.2em;" value="" placeholder="请手动输入"/ >
                 </div>
              </div>
              <div class="ub yqq-w10" >
                 <div id="emptypurchaseNum" class="ub w-click yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">&diams;采购单号</div>
                 <div id="purchaseNum" class="w-click ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div id="emptyshippingSpace" class="ub yqq-w3 w-click yqq-bbd uinn ub-pc ub-ac wkf-font-w">库位</div>
                 <div id="shippingSpace" class="w-click ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z br"></div>
              </div>
              <div class="ub yqq-w10" >
                 <div class="ub yqq-w3 yqq-bbd uinn ub-pc ub-ac wkf-font-w">仓库</div>
                 <div id="wareHouse"    class="ub ub-f1 umar-l yqq-bbd uinn ub-ac ub-pc  wkf-hh wkf-font-z"></div>
              </div>
          </div>
          <!--采购单号结束-->
           <div id="down" class="ub ub-f1 ub-ver yqq-xxk uc-a uinn umar-a " style="margin-bottom: 2em;color:white;">
              <div id="" class="ub ub-f1">
                  <div class="ub wkf-font-w umar-l uinn">条码</div>
                  <div class="ub ub-f1 ub-pe">
                      <div class="ub uinn uc-a" id="deleteBarcoe" style="background-color: #2B6576">删除</div>
                  </div>
              </div>
              <div id="bar_append" class="wkf-hh1">
              </div>
              <!-- <label onclick="openNum('9900001173')"> 9900001173&nbsp;&nbsp;</label> -->
           </div>
        </div>
       
    <script src="../js/appcan.js"></script>
    <script src="../js/appcan.control.js"></script>
    <script src="../js/locStorageModify.js"></script>
    <script src="../js/jquery.min.js"></script>
    </body>
    <script>
        //全局变量 存数据
        //全部条码
        var stationObj = {};//工位的对象
        var categoryObj = {};//单别的对象
        var supplierObj = {};//供应商对象
        var shippingSpaceObj = {};//库位对象
        var purchaseNumObj = {};//采购单号对像
        var detailNeed = [];//总计需要字段
        var materialObj = {};
        var materialSObj = {};
        //取出工位
        var LOGIN = appcan.locStorage.getVal("LOGIN");
        LOGIN = JSON.parse( LOGIN );
        
        var barcodeBaseInfo = [];
        //当前组条码
        var barcodeArrNow = [];
        var clickIndex;//点击物料条码详情  数组下标
        var windowId//开窗的id
        //避免重复条码扫描
        var barcodeArr = []; 
        appcan.ready(function() {
            stationAjax(LOGIN.StationID);
//      获取当前日期
            var myDate = new Date();
            $("#time").html(myDate.getFullYear()+'/'+(myDate.getMonth()+1)+'/'+myDate.getDate());   
//      日期选择器的回调   
            uexControl.cbOpenDatePicker = function (opId,dataType,data) {
                var oData=eval('('+data+')');
                $("#time").html(oData.year+'/'+oData.month+'/'+oData.day);   
            }
        });
        appcan.button(".w-click","ani-act",function(){
           windowId = this.id;
           switch( this.id ){
             case 'station': openWindow('risStation'); break;
             case 'category': openWindow('risCategory') ;break;
             case 'supplier': openWindow('risSupplier'); break;
             case 'articleNum': if($('#barcode').html() == ''){appcan.window.openToast('请先扫描获取条码！',1000,5,0);return;}openWindow('istGoodsId');openWindow('risGoodsId'); break;
             case 'purchaseNum': openWindow('risPurchaseNum'); break;
             case 'shippingSpace': openWindow('risShippingSpace'); break;
             // case 'emptystation': stationAjax(9900001471); break;
             // case 'emptycategory': categoryAjax(123456); break;
             // case 'emptysupplier': supplierAjax(9900001465); break;
             // case 'emptyBarcode': barcodeAjax(9900001447); break;//9900001525
             // case 'emptyshippingSpace': shippingSpaceAjax( 9900001501 ); break;
             case 'emptystation': $("#station").html(""); break;
             case 'emptycategory':  $("#category").html(""); break;
             case 'emptysupplier':  $("#supplier").html(""); break;
             case 'emptyBarcode': $("#barcode").html(""); break;
             case 'emptyNum':  $("#articleNum").html(""); $("#articleName").html(""); $("#standard").html(""); $("#amount").html(""); $("#unit").html(""); break;
             case 'emptypurchaseNum':  $("#purchaseNum").html(""); break;
             case 'emptyshippingSpace':  $("#shippingSpace").html(""); $("#wareHouse").html(""); break;
           }
        })
        //打开时间选择器
        appcan.button("#time","ani-act",function(){
            var myDate = new Date();
             uexControl.openDatePicker(myDate.getFullYear(),(myDate.getMonth()+1),myDate.getDate());   
        })
        //开窗
        function openWindow( name ){
            localOption.localSave( name );
            appcan.window.open({
                name:name,
                data:name+'.html',
            })
        }
        //点击条码打开详情窗口
        function openNum(num){
            for(var i =0 ; i<=barcodeBaseInfo.length; i++){
                if(num == barcodeBaseInfo[i].materialCode){
                    clickIndex = i;
                    appcan.locStorage.val('BARCODEDETAILE',barcodeBaseInfo[i]);
                    break;
                }
            }
            localOption.localSave( 'purNumDetail' );
            appcan.window.open({
                name:'risAmountDetail',
                data:'risAmountDetail.html',
            })
        }
        //接受扫描数据
        function getData( Data )
        {
            // alert( Data );
            if($("#station").html() == null || $("#station").html() == ""){
                 stationAjax( Data );
            }else if($("#category").html() == null || $("#category").html() == ""){
                 categoryAjax( Data );
            }else if($("#supplier").html() == null || $("#supplier").html() == ""){
                 supplierAjax( Data );
            }else if($("#barcode").html() == null|| $("#barcode").html() == ""){
                barcodeAjax( Data );
            }else if($('#amount').val() == ''){
                appcan.window.openToast('请先输入数量！',1000,5,0);
            }else if($("#purchaseNum").html() == null || $("#purchaseNum").html() == ""){
                 appcan.window.openToast('请先选择采购单号！',1000,5,0);
            }else if($("#shippingSpace").html() == null || $("#shippingSpace").html() == ""){
                 shippingSpaceAjax( Data );
            }
        }       
        //satation-->ajax
        function stationAjax( Data ){
            appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:{
                        LogicType:"扫码",
                        ScanType:"工位精确查询",
                        StationInput:{
                                "StationBarCode":Data,//"9900001471"
                        }
                   }
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.window.alert(JSON.stringify(info));
                    if(!info.bSuccess){
                        appcan.window.openToast(info.Error,3000,5,0);
                        return;
                    }
                    if( info.StationOutput.IsSuccess ){
                        stationObj = info.StationOutput.StationInfo;
                        $("#station").html(info.StationOutput.StationInfo.StationName);
                        $('html,body').animate({scrollTop:$('#station').offset().top-80},1000);
                    }else{
                        appcan.window.openToast(info.Error,3000,5,0);
                    }
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })
        }
        //category-->ajax
        function categoryAjax( Data ){
            appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:{
                        LogicType:"扫码",
                        ScanType:"单别精确查询",
                        BillTypeInput:{
                            Barcode:Data,//123456
                        }
                    }
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.alert( JSON.stringify( info ) );
                    if( info.BillTypeOutput.hasBillTypeInfo  ){
                        categoryObj = info.BillTypeOutput.BillTypeInfoList[0];
                        $("#category").html(info.BillTypeOutput.BillTypeInfoList[0].Name);
                        $('html,body').animate({scrollTop:$('#category').offset().top-80},1000);
                    } else {
                        appcan.window.openToast("单别查询错误！",1000,5,0);
                    }
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })
        }
        //supplier-->ajax
        function supplierAjax( Data ){
            appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:{
                        LogicType:"扫码",
                        ScanType:"供应商精确查询",
                        SupplierInput:{
                            "Barcode":Data,//"9900001462"
                        }
                    }
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.window.alert(JSON.stringify(info))
                    if(!info.bSuccess){
                        appcan.window.openToast(info.Error,3000,5,0);
                        return;
                    }
                    if( info.SupplierOutput.bOperateSuccess  ){
                        supplierObj = info.SupplierOutput.Barcode.Supplier;
                        $("#supplier").html(info.SupplierOutput.Barcode.Supplier.SupplierName);
                        $('html,body').animate({scrollTop:$('#supplier').offset().top-80},1000);
                    }else{
                        appcan.window.openToast(info.Error,3000,5,0);
                    }
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })
        }

        //barcode -->ajax
        function barcodeAjax( Data ){
            if( barcodeArr.indexOf(Data) !== -1){
                appcan.window.openToast('条码重复!',1000,5,0);
                return;
            }
            appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:{
                        LogicType:"扫码",
                        scanType:"通用扫码",
                        barcode:Data
                    }
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.alert( 1 , JSON.stringify( info ) );
                    if( info.BarcodeType=="1" ){//容器码 类型判断
                        if( info.isBarcodeBeUsed  ){        //容器码是否实例化
                            if(info.BarcodeInfo.materialbarcodeList == null || info.BarcodeInfo.materialbarcodeList.length == 0){
                                appcan.window.openToast("容器码为空！",1000,5,0);
                                return;
                            }
                            TYPE = "容器";
                            $("#barcode").html( Data );
                            materialObj = info.BarcodeInfo.materialbarcode;
                            if(info.BarcodeInfo.materialbarcodeList.length == 1){
                                 materialSObj = info.BarcodeInfo.materialbarcodeList[0];
                                 $("#articleName").html(info.BarcodeInfo.materialbarcodeList[0].MatName);
                                $("#articleNum").html(info.BarcodeInfo.materialbarcodeList[0].MaterialID);
                                $("#standard").html(info.BarcodeInfo.materialbarcodeList[0].Specifications);
                                $("#unit").html(info.BarcodeInfo.materialbarcodeList[0].Company);
                             }
                             appcan.locStorage.setVal( "RETURNINWORDPRODUCT" , info.BarcodeInfo );
                             $('html,body').animate({scrollTop:$('#barcode').offset().top-80},1000);
                        }else {
                            appcan.window.openToast("条码无实例！",1000,5,0);
                        }
                    // }else if( info.BarcodeType=="14" ){//包装码 类型判断
                            // if( info.isBarcodeBeUsed  ){        //包装码是否实例化
                                // TYPE = "包装";                              
                                // InPack = info.BarcodeInfo;
                                // $("#barcode").html( Data );
                                // $("#amount").val( 1 );
                            // } else {
                                // appcan.window.openToast("条码无实例！",1000,5,0);
                            // }
                    }else if( info.BarcodeType=="9" ){//物料实例码 类型判断
                        if( info.isBarcodeBeUsed  ){        //物料实例码是否实例化
                            TYPE = "物料";
                            $("#materialNumber").html( Data );
                            materialObj = info.BarcodeInfo.materialbarcode;
                            materialSObj = info.BarcodeInfo.materialbarcode;
                            $('#barcode').html(Data);
                            $("#articleName").html(info.BarcodeInfo.materialbarcode.MatName);
                            $("#articleNum").html(info.BarcodeInfo.materialbarcode.MaterialID);
                            $("#standard").html(info.BarcodeInfo.materialbarcode.Specifications);
                            $("#unit").html(info.BarcodeInfo.materialbarcode.Company);
                             $('html,body').animate({scrollTop:$('#barcode').offset().top-80},1000);
                             barcodeArr.push(Data);
                        } else {
                                appcan.window.openToast("条码无实例！",1000,5,0);
                        }
                    } else {
                        appcan.window.openToast("条码类型错误！",1000,5,0);
                    }
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })
        }
        
        //shippingSpace -->ajax
        function shippingSpaceAjax( Data ){
           //先判断是否都有值
           if($("#barcode").html() == "" || $("#barcode").html() == null){
               appcan.window.openToast("请先扫描条码！",1000,5,0);
               return ;
           }else if($("#articleNum").html() == "" || $("#articleNum").html() == null){
               appcan.window.openToast("请先选择品号！",1000,5,0);
               return ;
           }else if($("#amount").val() == "" || $("#amount").val() == null){
               appcan.window.openToast("请先填写数量！",1000,5,0);
               return ;
           }else if($("#purchaseNum").html() == "" || $("#purchaseNum").html() == null){
               appcan.window.openToast("请先添加采购单号！",1000,5,0);
               return ;
           }
            appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:{
                        LogicType:"扫码",
                        ScanType:"库位精确查询",
                        StoreLocationInput:{
                            AlibraryBarcode:Data
                        }
                    }
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.alert(JSON.stringify( info ));
                    if(!info.bSuccess){
                        appcan.window.openToast(info['Error'],1000,5,0);
                        return ;
                    }
                    if( info.StoreLocationOutput.bOperateSuccess  ){
                        shippingSpaceObj = info.StoreLocationOutput.Alibrary;
                        $("#shippingSpace").html(info.StoreLocationOutput.Alibrary.AlibraryName);
                        $("#wareHouse").html(info.StoreLocationOutput.Alibrary.WarehouseName);
                        $('html,body').animate({scrollTop:$('#shippingSpace').offset().top-80},1000);
                    }
                    else{
                        appcan.window.openToast("没有该库位！",1000,5,0);
                    }                    
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })
        }
        //删除当前条码
        appcan.button('#deleteBarcoe','ani-act',function(){
            $('#bar_append>:first').remove();
            if($("#materialNumber").html() == null || $("#materialNumber").html() == ""){
                    barcodeArrNow.pop();
                    barcodeArr.pop();
                    detailNeed.pop();
                    barcodeBaseInfo.pop();
            } else {
                    $("#barcode").html("");
                    $("#articleNum").html("");
                    $("#articleName").html("");
                    $("#standard").html("");
                    $("#amount").val("");
                    $("#unit").html("单位");
                    $("#purchaseNum").html("");
                    $("#shippingSpace").html("");
                    $("#wareHouse").html("");
            }
            appcan.window.evaluateScript({
                name:"returnsInwards",
                scriptContent:"modifyCount("+detailNeed.length+")"
            });
        });
        
        
       //保存数据
       function returnsInwardsSave(){
           //先判断是否都有值
           if($("#barcode").html() == "" || $("#barcode").html() == null){
               appcan.window.openToast("请先扫描条码！",1000,5,0);
               return ;
           }
           if($("#articleNum").html() == "" || $("#articleNum").html() == null){
               appcan.window.openToast("请先选择品号！",1000,5,0);
               return ;
           }    
           if($("#amount").val() == "" || $("#amount").val() == null){
               appcan.window.openToast("请先填写数量！",1000,5,0);
               return ;
           }
           if($("#purchaseNum").html() == "" || $("#purchaseNum").html() == null){
               appcan.window.openToast("请先添加采购单号！",1000,5,0);
               return ;
           };
            if($("#shippingSpace").html() == "" || $("#shippingSpace").html() == null){
               appcan.window.openToast("请先添加库位！",1000,5,0);
               return ;
           }
            //显示
            var str = '<label>'+$("#barcode").html()+'&nbsp;&nbsp;</label>'
            $('#bar_append').prepend(str);
          appcan.window.alert({
            title:'提示',
            content:'是否保存',
            buttons:['是','否'],
            callback:function(err,data,dataType,optId){
               if( data == 0 ){
               //完整数据存入对象
               var updataPartJson = {
                    "Barcode": materialSObj.Barcode,
                    "MarterialGuid": materialSObj.GUID,
                    "Amount": $("#amount").val(),
                    "WareHoseBarcode": shippingSpaceObj.WarehouseBarcode,
                    "WareHoseNumber": shippingSpaceObj.WarehouseName,
                };
               Djson = {
                     BarCode :$("#barcode").html(),
                     PRONAME:$("#articleName").html(), 
                     ProductNo :$("#articleNum").html(),
                     Specifications:$("#standard").html(),
                     Num:$("#amount").val(),
                     Unit:$("#unit").html(),
                     ProcurementNumber:$("#purchaseNum").html(),
                    WARE:$("#shippingSpace").html(), 
                    ALIB:$("#wareHouse").html(),
               };
                   detailNeed.push(Djson) ;
                   barcodeBaseInfo.push(updataPartJson);
                   appcan.window.openToast("保存成功！",1000,5,0);
                   //清空updatapart
                   //appcan.window.alert(JSON.stringify(updataPartJson));
                   $("#barcode").html("");
                   $("#articleName").html("");
                   $("#articleNum").html("");
                   $("#standard").html("");
                   $("#amount").val("");
                   $("#unit").html("");
                   $("#purchaseNum").html("");
                   $("#shippingSpace").html("");
                   $("#wareHouse").html("");
                   // barcodeArrNow = [];
                    appcan.window.evaluateScript({
                        name:"returnsInwards",
                        scriptContent:"modifyCount("+detailNeed.length+")"
                    });
                   $('html,body').animate({scrollTop:$('#barcode').offset().top-80},1000);
               }
            }
          })
       }
       function returnsInwardsSubmit(){
           if(!confirm("确定提交？")){
               return;
           }
           if( barcodeBaseInfo.length === 0){
               appcan.window.openToast('当前没有可提交数据！',1000,5,0);
               return;
           } else {
               appcan.window.openToast('提交中...',10000,5,1);
           }
           var submitInfo = {
            "StationBarcode": stationObj.StationBarcode,
            "SingleType": categoryObj.Name,
            "SuppierID":supplierObj.Id,
            "SuppierName": supplierObj.SupplierName,
            "PurchaseNo": purchaseNumObj.ProductNo,
            "OperaterId": LOGIN.UserID,
            "Operater": LOGIN.U_LoginName,
              lstPurchaseRetun:barcodeBaseInfo
           }
           // appcan.window.alert( "提示" , JSON.stringify(submitInfo) );         
           var  input={
              LogicType:"流转工位管理",
              OpType:"采购退货",
              PurchaseReturn:submitInfo
            }
           // appcan.window.alert( "提示", JSON.stringify(input) );                             
           appcan.request.ajax({
                url:"http://10.101.55.75/fzzy/SPEngine/Barcode",
                type:"POST",
                data:{
                    input:input
                },
                dataType:"json",
                success : function( info ) {
                    // appcan.window.alert(JSON.stringify(info));
                    appcan.window.closeToast();
                    if( info.bSuccess ){
                        appcan.window.openToast("提交成功",1000,5,0);
                        // uexWindow.reload();
                        appcan.window.evaluateScript({
                            name : 'returnsInwards',
                            scriptContent : 'subReview()',
                        })
                    }else{
                        appcan.window.openToast(info.Error,1000,5,0);
                    }
                },
                error: function(){
                    appcan.window.openToast("网络请求错误！",1000,5,0);
                }
            })       
       }
       //删除条码记录
       function deleteNum(deleteNum){
           barcodeBaseInfo.splice(clickIndex,1);
           $('#'+deleteNum).remove();
       }
       //开窗带回函数
       function openWindowBack (Obj){
            var Obj = JSON.parse( Obj );
            // appcan.window.alert( windowId ,JSON.stringify(Obj));
            switch( windowId )
            {
                case 'station': {
                     $("#station").html(Obj.StationName);
                     stationObj = Obj;
                     break;
                }
                case 'category':{
                    $("#category").html(Obj.Name);
                    categoryObj = Obj;
                    break;
                }
                case 'supplier':{
                    $("#supplier").html(Obj.Supplier.SupplierName);
                    supplierObj = Obj.Supplier;
                    break;
                }
                case 'articleNum':{
                    $("#articleNum").html(Obj.MaterialID);
                    $("#articleName").html(Obj.MatName);
                    $("#standard").html(Obj.Brand);
                    $("#unit").html('('+Obj.Company+')');
                    materialSObj = Obj;                                  //????????????
                    break;
                }
                case 'purchaseNum':{
                    $("#purchaseNum").html(Obj.PurchaseOrder);
                    purchaseNumObj = Obj;
                    break;
                }
                case 'shippingSpace':{
                    $("#shippingSpace").html(Obj.AlibraryName);
                    $("#wareHouse").html(Obj.WarehouseName);
                    shippingSpaceObj = Obj;
                    break;
                }
            }
       }
       
       //开启总计页面
       function openTotal(){
           localOption.localSave('amountDetail');
           appcan.locStorage.val('AMOUNTDETAILINFO',detailNeed);
           appcan.window.open({
               name:"risAmountDetail",
               data:"risAmountDetail.html"
           });
       }
        
    </script>
</html>
